<!-- BEGIN_TF_DOCS -->
<!-- Code generated by terraform-docs. DO NOT EDIT. -->
# Azure Storage Account Module

This module creates an Azure Storage Account with configurable tiers, replication options, and security features.
The module provides a standardized approach to cloud storage with support for blobs, files, queues, tables,
and advanced features like SFTP and hierarchical namespace.

The module leverages Azure Verified Modules (AVM) to ensure best practices and provides configurable
network access controls, private endpoints, and role-based access control for secure data management.

## Features

This module provides storage account functionality with the following capabilities:

- Creates Storage Account with standardized naming conventions
- Support for multiple storage tiers (Standard, Premium)
- Configurable replication types (LRS, GRS, RAGRS, ZRS, GZRS, RAGZRS)
- Network firewall rules with IP allowlisting
- Private endpoint support for secure connectivity
- SFTP protocol support with hierarchical namespace
- Container and queue creation
- Role-based access control (RBAC) assignments
- Comprehensive tagging support

## Usage

To use this module in your Terraform configuration, you'll need to provide values for the required variables.

### Example - Basic Storage Account with Containers

This example shows the most basic usage of the module for creating a storage account with containers.
```terraform
module "storage_account" {
  source = "./modules/storage_account"

  # Basic naming and location variables
  instance          = 1
  location          = "West Europe"
  stage             = "dev"
  product           = "dbk"
  short_description = "data"
  # Resource group
  resource_group_name = "rg-dbk-dev-westeurope-01"

  # Storage Account configuration
  storage_tier                      = "Standard"
  replication_type                  = "GRS"
  storage_access_tier               = "Hot"
  public_network_access_enabled     = false
  shared_access_key_enabled         = false
  allow_nested_items_to_be_public   = false
  default_to_oauth_authentication   = true
  allowed_copy_scope                = "AAD"

  # SFTP configuration
  sftp_enabled = true

  # Network firewall
  enable_firewall = true
  network_bypass = ["AzureServices"]
  allowed_ip_ranges = {
    "office"     = "203.0.113.0/24"
    "build-agent" = "198.51.100.1/32"
  }

  # Containers
  containers = {
    "documents" = {
      container_access_type = "private"
    }
    "backups" = {
      container_access_type = "private"
    }
    "logs" = {
      container_access_type = "private"
    }
  }

  # Queues
  queues = {
    "processing-queue" = {}
    "notifications"    = {}
  }

  # Role assignments
  roles = {
    "app-identity" = {
      role_definition_id_or_name = "Storage Blob Data Contributor"
      principal_id               = "12345678-1234-1234-1234-123456789012"
    }
    "backup-service" = {
      role_definition_id_or_name = "Storage Blob Data Reader"
      principal_id               = "87654321-4321-4321-4321-210987654321"
    }
  }

  # Private endpoints
  private_endpoints = {
    "blob" = {
      private_dns_zone_resource_id = "/subscriptions/sub-id/resourceGroups/rg-dns/providers/Microsoft.Network/privateDnsZones/privatelink.blob.core.windows.net"
      subnet_resource_id           = "/subscriptions/sub-id/resourceGroups/rg-network/providers/Microsoft.Network/virtualNetworks/vnet-main/subnets/snet-pe"
      subresource_name             = "blob"
      resource_group_name          = "rg-dbk-dev-westeurope-01"
    }
    "file" = {
      private_dns_zone_resource_id = "/subscriptions/sub-id/resourceGroups/rg-dns/providers/Microsoft.Network/privateDnsZones/privatelink.file.core.windows.net"
      subnet_resource_id           = "/subscriptions/sub-id/resourceGroups/rg-network/providers/Microsoft.Network/virtualNetworks/vnet-main/subnets/snet-pe"
      subresource_name             = "file"
      resource_group_name          = "rg-dbk-dev-westeurope-01"
    }
  }

  # Tags
  tags = {
    environment = "dbk-dev-westeurope"
    project     = "digital-transformation"
  }
}
```

<!-- markdownlint-disable MD033 -->
## Requirements

No requirements.

## Resources

The following resources are used by this module:

- [azurerm_storage_account_local_user.admins](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/storage_account_local_user) (resource)

<!-- markdownlint-disable MD013 -->
## Required Inputs

The following input variables are required:

### <a name="input_instance"></a> [instance](#input\_instance)

Description: Environment instance for region

Type: `number`

### <a name="input_location"></a> [location](#input\_location)

Description: Azure region

Type: `string`

### <a name="input_product"></a> [product](#input\_product)

Description: The product name this resource belongs to

Type: `string`

### <a name="input_resource_group_name"></a> [resource\_group\_name](#input\_resource\_group\_name)

Description: Resource group name

Type: `string`

### <a name="input_stage"></a> [stage](#input\_stage)

Description: Stage the resource is provisioned

Type: `string`

## Optional Inputs

The following input variables are optional (have default values):

### <a name="input_allow_nested_items_to_be_public"></a> [allow\_nested\_items\_to\_be\_public](#input\_allow\_nested\_items\_to\_be\_public)

Description: Allow nested items (e.g., blobs) to be public

Type: `bool`

Default: `false`

### <a name="input_allowed_copy_scope"></a> [allowed\_copy\_scope](#input\_allowed\_copy\_scope)

Description: Restrict copy operations to a specific scope (e.g., resource group or subscription)

Type: `string`

Default: `null`

### <a name="input_allowed_ip_ranges"></a> [allowed\_ip\_ranges](#input\_allowed\_ip\_ranges)

Description: Map of allowed IPs when firewall is enabled

Type: `map(string)`

Default: `{}`

### <a name="input_containers"></a> [containers](#input\_containers)

Description: Map of storage containers to create within the Storage Account.

Map key is an arbitrary identifier. Each object supports:

- `name` - Name of the container to create.
- `public_access` - Optional. Public access level for the container. One of: "None", "Blob", or "Container". Defaults to "None".

Type:

```hcl
map(object({
    name          = string
    public_access = optional(string, "None")
  }))
```

Default: `{}`

### <a name="input_default_to_oauth_authentication"></a> [default\_to\_oauth\_authentication](#input\_default\_to\_oauth\_authentication)

Description: Default to OAuth (Azure AD) authentication when connecting to Storage resources

Type: `bool`

Default: `true`

### <a name="input_enable_firewall"></a> [enable\_firewall](#input\_enable\_firewall)

Description: Enable firewall and restrict access to trusted networks

Type: `bool`

Default: `false`

### <a name="input_network_bypass"></a> [network\_bypass](#input\_network\_bypass)

Description: Services that can bypass the network rules (e.g., AzureServices)

Type: `set(string)`

Default:

```json
[
  "AzureServices"
]
```

### <a name="input_private_endpoints"></a> [private\_endpoints](#input\_private\_endpoints)

Description: A map of Private Endpoints to create for the Storage Account.

Map key is an arbitrary identifier. Each object supports:

- `private_dns_zone_resource_id` - Resource ID of the Private DNS Zone to link (e.g. .../privateDnsZones/privatelink.blob.core.windows.net). Use a zone appropriate for the subresource.
- `subnet_resource_id` - Resource ID of the subnet where the Private Endpoint will be created.
- `subresource_name` - The subresource to connect (e.g., "blob", "file", "queue", "table", or "dfs" for ADLS Gen2).
- `resource_group_name` - Optional. Target resource group name for the Private Endpoint resource. If omitted, module defaults are used.

Type:

```hcl
map(object({
    private_dns_zone_resource_id = string
    subnet_resource_id           = string
    subresource_name             = string
    resource_group_name          = optional(string)
  }))
```

Default: `{}`

### <a name="input_public_network_access_enabled"></a> [public\_network\_access\_enabled](#input\_public\_network\_access\_enabled)

Description: Whether public network access is enabled

Type: `bool`

Default: `false`

### <a name="input_queues"></a> [queues](#input\_queues)

Description: Map of Storage Queues to create.

Map key is an arbitrary identifier. Each object supports:

- `name` - The name of the queue to create.

Type:

```hcl
map(object({
    name = string
  }))
```

Default: `{}`

### <a name="input_replication_type"></a> [replication\_type](#input\_replication\_type)

Description: Storage Replication Type (LRS, GRS, ZRS, etc.)

Type: `string`

Default: `"LRS"`

### <a name="input_roles"></a> [roles](#input\_roles)

Description: Map of role assignments to create for the Storage Account.

Map key is an arbitrary identifier. Each object supports:

- `role_definition_id_or_name` - The role to assign. Can be a built-in role name (e.g., "Storage Blob Data Contributor") or a role definition ID (GUID).
- `principal_id` - Object ID of the principal (user, group, or managed identity) that will receive the role assignment.

Type:

```hcl
map(object({
    role_definition_id_or_name = string
    principal_id               = string
  }))
```

Default: `{}`

### <a name="input_sftp_admins"></a> [sftp\_admins](#input\_sftp\_admins)

Description: Map of SFTP local users to create and grant container permissions.

Map key is an arbitrary identifier. Each object supports:

- `name` - The username for the local user.
- `containers` - List of container names the user should have access to.

Type:

```hcl
map(object({
    name       = string
    containers = list(string)
  }))
```

Default: `{}`

### <a name="input_sftp_enabled"></a> [sftp\_enabled](#input\_sftp\_enabled)

Description: Enable SFTP support on the Storage Account

Type: `bool`

Default: `false`

### <a name="input_shared_access_key_enabled"></a> [shared\_access\_key\_enabled](#input\_shared\_access\_key\_enabled)

Description: Enable Shared Key (Access Key) authentication for the Storage Account

Type: `bool`

Default: `false`

### <a name="input_short_description"></a> [short\_description](#input\_short\_description)

Description: Optional short description of the resource

Type: `string`

Default: `null`

### <a name="input_storage_access_tier"></a> [storage\_access\_tier](#input\_storage\_access\_tier)

Description: Storage Access Tier (Hot, Cool)

Type: `string`

Default: `"Hot"`

### <a name="input_storage_tier"></a> [storage\_tier](#input\_storage\_tier)

Description: Storage Account Tier (Standard, Premium)

Type: `string`

Default: `"Standard"`

### <a name="input_tags"></a> [tags](#input\_tags)

Description: A mapping of tags to assign to the resource

Type: `map(string)`

Default: `{}`

## Outputs

The following outputs are exported:

### <a name="output_name"></a> [name](#output\_name)

Description: n/a

### <a name="output_primary_blob_endpoint"></a> [primary\_blob\_endpoint](#output\_primary\_blob\_endpoint)

Description: n/a

### <a name="output_primary_connection_string"></a> [primary\_connection\_string](#output\_primary\_connection\_string)

Description: n/a

### <a name="output_primary_dfs_endpoint"></a> [primary\_dfs\_endpoint](#output\_primary\_dfs\_endpoint)

Description: n/a

### <a name="output_primary_file_endpoint"></a> [primary\_file\_endpoint](#output\_primary\_file\_endpoint)

Description: n/a

### <a name="output_primary_key"></a> [primary\_key](#output\_primary\_key)

Description: n/a

### <a name="output_primary_queue_endpoint"></a> [primary\_queue\_endpoint](#output\_primary\_queue\_endpoint)

Description: n/a

### <a name="output_primary_table_endpoint"></a> [primary\_table\_endpoint](#output\_primary\_table\_endpoint)

Description: n/a

### <a name="output_queues"></a> [queues](#output\_queues)

Description: n/a

### <a name="output_resource_id"></a> [resource\_id](#output\_resource\_id)

Description: n/a

### <a name="output_sftp_admins"></a> [sftp\_admins](#output\_sftp\_admins)

Description: n/a

### <a name="output_storage_account_blob_fqdn"></a> [storage\_account\_blob\_fqdn](#output\_storage\_account\_blob\_fqdn)

Description: n/a

### <a name="output_storage_containers"></a> [storage\_containers](#output\_storage\_containers)

Description: List of created storage container names

## Modules

The following Modules are called:

### <a name="module_naming"></a> [naming](#module\_naming)

Source: ../naming

Version:

### <a name="module_naming_nic"></a> [naming\_nic](#module\_naming\_nic)

Source: ../naming

Version:

### <a name="module_naming_pe"></a> [naming\_pe](#module\_naming\_pe)

Source: ../naming

Version:

### <a name="module_naming_psc"></a> [naming\_psc](#module\_naming\_psc)

Source: ../naming

Version:

### <a name="module_this"></a> [this](#module\_this)

Source: Azure/avm-res-storage-storageaccount/azurerm

Version: 0.6.4

<!-- END_TF_DOCS -->
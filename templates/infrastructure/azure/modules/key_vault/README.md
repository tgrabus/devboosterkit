<!-- BEGIN_TF_DOCS -->
<!-- Code generated by terraform-docs. DO NOT EDIT. -->
# Azure Key Vault Module

This module creates an Azure Key Vault with comprehensive security features, including private endpoints, network access controls, and role-based access management.
Key Vault provides secure storage for secrets, keys, and certificates used by applications and services.

The module leverages Azure Verified Modules (AVM) to ensure best practices and provides flexible configuration options for different security and compliance requirements.

## Features

This module provides Key Vault functionality with the following capabilities:

- Creates Azure Key Vault with standardized naming conventions
- Supports private endpoints for secure network connectivity
- Configurable public network access with IP-based firewall rules
- Role-based access control (RBAC) instead of legacy access policies
- Soft delete and purge protection capabilities
- Support for both standard and premium SKUs
- Secret management with lifecycle configuration

## Usage

To use this module in your Terraform configuration, you'll need to provide values for the required variables.

### Example - Basic Key Vault

This example shows the most basic usage of the module for creating a Key Vault.
```terraform
module "secret_storage" {
  source = "../../modules/key_vault"

  # Basic naming and location variables
  instance          = 1
  location          = "West Europe"
  stage             = "dev"
  product           = "myapp"
  short_description = "secrets"

  # Resource group
  resource_group_name = "rg-myapp-dev-westeurope-1-app"

  # Azure AD configuration
  tenant_id = "12345678-1234-1234-1234-123456789012"

  # Network access configuration
  public_network_access_enabled = true
  allowed_ip_ranges = {
    "office_network" = "203.0.113.0/24"
    "developer_home" = "198.51.100.50/32"
    "ci_cd_pipeline" = "192.0.2.100/32"
  }

  # Private endpoint configuration
  private_endpoints = {
    key_vault_pe = {
      private_dns_zone_resource_id = "/subscriptions/12345678-1234-1234-1234-123456789012/resourceGroups/rg-myapp-dev-westeurope-1-dns/providers/Microsoft.Network/privateDnsZones/privatelink.vaultcore.azure.net"
      subnet_resource_id           = "/subscriptions/12345678-1234-1234-1234-123456789012/resourceGroups/rg-myapp-dev-westeurope-1-vnet/providers/Microsoft.Network/virtualNetworks/vnet-myapp-dev-westeurope-1/subnets/snet-private-endpoints"
      resource_group_name          = "rg-myapp-dev-westeurope-1-vnet"
    }
  }

  # Role-based access control
  roles = {
    app_secrets_user = {
      role_definition_id_or_name = "Key Vault Secrets User"
      principal_id               = "87654321-4321-4321-4321-210987654321"
    }
    admin_secrets_officer = {
      role_definition_id_or_name = "Key Vault Secrets Officer"
      principal_id               = "11111111-2222-3333-4444-555555555555"
    }
    backup_operator = {
      role_definition_id_or_name = "Key Vault Reader"
      principal_id               = "66666666-7777-8888-9999-000000000000"
    }
  }

  # Secrets configuration
  secrets = {
    api_key = {
      name                 = "third-party-api-key"
      value                = "sk-1234567890abcdef1234567890abcdef"
      ignore_value_changes = true
      content_type         = "application/x-api-key"
    }
    jwt_secret = {
      name                 = "jwt-signing-secret"
      value                = "my-super-secret-jwt-signing-key-that-should-be-random"
      ignore_value_changes = false
      content_type         = "text/plain"
    }
  }

  # Key Vault configuration
  sku_name                   = "standard"
  soft_delete_retention_days = 90
  purge_protection_enabled   = true

  # Diagnostic settings
  diagnostic_settings = {
    key_vault_logs = {
      workspace_resource_id = "/subscriptions/12345678-1234-1234-1234-123456789012/resourceGroups/rg-myapp-dev-westeurope-1-observability/providers/Microsoft.OperationalInsights/workspaces/law-myapp-dev-westeurope-1"
      log_categories = [
        "AuditEvent",
        "AzurePolicyEvaluationDetails"
      ]
      metric_categories = [
        "AllMetrics"
      ]
    }
  }

  # Resource tags
  tags = {
    environment = "myapp_dev_westeurope_1"
    project     = "digital-transformation"
  }
}

```

<!-- markdownlint-disable MD033 -->
## Requirements

No requirements.

## Resources

No resources.

<!-- markdownlint-disable MD013 -->
## Required Inputs

The following input variables are required:

### <a name="input_instance"></a> [instance](#input\_instance)

Description: Environment instance for region

Type: `number`

### <a name="input_location"></a> [location](#input\_location)

Description: Azure region

Type: `string`

### <a name="input_product"></a> [product](#input\_product)

Description: The product name this resource belongs to

Type: `string`

### <a name="input_resource_group_name"></a> [resource\_group\_name](#input\_resource\_group\_name)

Description: Resource group name

Type: `string`

### <a name="input_stage"></a> [stage](#input\_stage)

Description: Stage the resource is provisioned

Type: `string`

### <a name="input_tenant_id"></a> [tenant\_id](#input\_tenant\_id)

Description: The Azure Active Directory tenant ID that should be used for authenticating requests to the key vault.

Type: `string`

## Optional Inputs

The following input variables are optional (have default values):

### <a name="input_allowed_ip_ranges"></a> [allowed\_ip\_ranges](#input\_allowed\_ip\_ranges)

Description: List of allowed IPs when firewall is enabled

Type: `map(string)`

Default: `{}`

### <a name="input_private_endpoints"></a> [private\_endpoints](#input\_private\_endpoints)

Description: A map of private endpoints to create

Type:

```hcl
map(object({
    private_dns_zone_resource_id = string
    subnet_resource_id           = string
    resource_group_name          = optional(string)
  }))
```

Default: `{}`

### <a name="input_public_network_access_enabled"></a> [public\_network\_access\_enabled](#input\_public\_network\_access\_enabled)

Description: Enable firewall and restrict access to trusted networks

Type: `bool`

Default: `true`

### <a name="input_purge_protection_enabled"></a> [purge\_protection\_enabled](#input\_purge\_protection\_enabled)

Description: n/a

Type: `bool`

Default: `false`

### <a name="input_roles"></a> [roles](#input\_roles)

Description: n/a

Type:

```hcl
map(object({
    role_definition_id_or_name = string
    principal_id               = string
  }))
```

Default: `{}`

### <a name="input_secrets"></a> [secrets](#input\_secrets)

Description: n/a

Type:

```hcl
map(object({
    name                 = string
    value                = string
    content_type         = optional(string, "string")
    expiration_date      = optional(string)
    ignore_value_changes = optional(bool, false)
  }))
```

Default: `{}`

### <a name="input_short_description"></a> [short\_description](#input\_short\_description)

Description: Optional Short description of the resource

Type: `string`

Default: `null`

### <a name="input_sku_name"></a> [sku\_name](#input\_sku\_name)

Description: n/a

Type: `string`

Default: `"standard"`

### <a name="input_soft_delete_retention_days"></a> [soft\_delete\_retention\_days](#input\_soft\_delete\_retention\_days)

Description: The number of days that items should be retained for once soft-deleted

Type: `number`

Default: `null`

### <a name="input_tags"></a> [tags](#input\_tags)

Description: A mapping of tags to assign to the resource

Type: `map(string)`

Default: `{}`

## Outputs

The following outputs are exported:

### <a name="output_resource_id"></a> [resource\_id](#output\_resource\_id)

Description: Resource id

### <a name="output_secrets"></a> [secrets](#output\_secrets)

Description: List of secrets

## Modules

The following Modules are called:

### <a name="module_naming_kv"></a> [naming\_kv](#module\_naming\_kv)

Source: ../naming

Version:

### <a name="module_naming_nic"></a> [naming\_nic](#module\_naming\_nic)

Source: ../naming

Version:

### <a name="module_naming_pe"></a> [naming\_pe](#module\_naming\_pe)

Source: ../naming

Version:

### <a name="module_naming_psc"></a> [naming\_psc](#module\_naming\_psc)

Source: ../naming

Version:

### <a name="module_secrets"></a> [secrets](#module\_secrets)

Source: ./secret

Version:

### <a name="module_this"></a> [this](#module\_this)

Source: Azure/avm-res-keyvault-vault/azurerm

Version: 0.10.1

<!-- END_TF_DOCS -->
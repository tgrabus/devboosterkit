<!-- BEGIN_TF_DOCS -->
<!-- Code generated by terraform-docs. DO NOT EDIT. -->
# Azure SQL Server Module

This module creates an Azure SQL Server with databases, elastic pools, and comprehensive security configurations.
The module provides a standardized approach to deploying SQL Server instances with Azure Active Directory integration,
firewall rules, and audit logging capabilities.

The module leverages Azure Verified Modules (AVM) to ensure best practices and provides configurable
database configurations, backup policies, and private endpoint support for enhanced security.

## Features

This module provides SQL Server functionality with the following capabilities:

- Creates Azure SQL Server with standardized naming conventions
- Azure Active Directory administrator configuration
- Managed identity integration
- Firewall rules and network access control
- Private endpoint support for secure connectivity
- Elastic pool configuration for cost optimization
- Database creation with configurable service tiers
- Audit logging to storage account or Log Analytics
- Threat detection and vulnerability assessment
- Diagnostic settings integration
- Comprehensive tagging support

## Usage

To use this module in your Terraform configuration, you'll need to provide values for the required variables.

### Example - Basic SQL Server with Database

This example shows the most basic usage of the module for creating a SQL Server with a database.
```terraform
module "sql_server" {
  source = "./modules/sql_server"

  # Basic naming and location variables
  instance          = 1
  location          = "West Europe"
  stage             = "dev"
  product           = "dbk"
  short_description = "main"

  # Network access configuration
  public_network_access_enabled = false
  # Azure AD administrator configuration
  azuread_administrator = {
    azuread_authentication_only = true
    login_username              = "sql-admin@company.com"
    object_id                   = "12345678-1234-1234-1234-123456789012"
  }

  # Elastic pool configuration
  elastic_pool = {
    max_size_gb    = 100
    zone_redundant = true
    sku = {
      name     = "StandardPool"
      capacity = 100
      tier     = "Standard"
      family   = null
    }
    per_database_settings = {
      min_capacity = 0
      max_capacity = 100
    }
  }

  # Diagnostic settings for monitoring
  diagnostic_settings = {
    workspace_resource_id = "/subscriptions/12345678-1234-1234-1234-123456789012/resourceGroups/rg-monitoring/providers/Microsoft.OperationalInsights/workspaces/law-dbk-dev"
    enabled               = true
  }

  # Database configurations
  databases = {
    "app-primary" = {
      collation                   = "SQL_Latin1_General_CP1_CI_AS"
      max_size_gb                 = 50
      backup_storage_account_type = "Geo"
      
      short_term_retention_policy = {
        retention_days           = 14
        backup_interval_in_hours = 12
      }
      
      long_term_retention_policy = {
        weekly_retention  = "P1W"
        monthly_retention = "P1M"
        yearly_retention  = "P1Y"
        week_of_year      = 1
      }
    }
  }

  # Vulnerability assessment configuration
  vulnerability_assessment = {
    enabled         = true
    retention_days  = 90
    email_addresses = ["security@company.com", "dba@company.com"]
  }

  # Private endpoint configuration
  private_endpoints = {
    "sql-pe-001" = {
      private_dns_zone_resource_id = "/subscriptions/12345678-1234-1234-1234-123456789012/resourceGroups/rg-dns/providers/Microsoft.Network/privateDnsZones/privatelink.database.windows.net"
      subnet_resource_id           = "/subscriptions/12345678-1234-1234-1234-123456789012/resourceGroups/rg-network/providers/Microsoft.Network/virtualNetworks/vnet-dbk-dev/subnets/snet-database"
      resource_group_name          = "rg-dbk-dev-westeurope-001"
    }
  }

  # Firewall rules for specific IP addresses
  allowed_ips = {
    "office-network"     = "203.0.113.0/24"
    "backup-datacenter"  = "198.51.100.50/32"
    "admin-workstation"  = "192.0.2.100/32"
  }

  # Action group for monitoring alerts
  action_group_id = "/subscriptions/12345678-1234-1234-1234-123456789012/resourceGroups/rg-monitoring/providers/Microsoft.Insights/actionGroups/ag-sql-alerts"

  # Resource tags
  tags = {
    environment = "dbk-dev-westeurope"
    project     = "digital-transformation"
  }
}

```

<!-- markdownlint-disable MD033 -->
## Requirements

No requirements.

## Resources

The following resources are used by this module:

- [azurerm_monitor_diagnostic_setting.elastic_pool](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/monitor_diagnostic_setting) (resource)
- [azurerm_monitor_diagnostic_setting.sql_server](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/monitor_diagnostic_setting) (resource)
- [azurerm_monitor_metric_alert.elastic_pool](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/monitor_metric_alert) (resource)
- [azurerm_mssql_server_extended_auditing_policy.audit_policy](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/mssql_server_extended_auditing_policy) (resource)
- [azurerm_mssql_server_security_alert_policy.alert_policy](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/mssql_server_security_alert_policy) (resource)
- [azurerm_mssql_server_vulnerability_assessment.vulnerability_assessment](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/mssql_server_vulnerability_assessment) (resource)

<!-- markdownlint-disable MD013 -->
## Required Inputs

The following input variables are required:

### <a name="input_action_group_id"></a> [action\_group\_id](#input\_action\_group\_id)

Description: Action Group to use when alerts are raised

Type: `string`

### <a name="input_azuread_administrator"></a> [azuread\_administrator](#input\_azuread\_administrator)

Description: Azure AD administrator settings for the SQL server

Type:

```hcl
object({
    azuread_authentication_only = optional(bool, true)
    login_username              = string
    object_id                   = string
  })
```

### <a name="input_diagnostic_settings"></a> [diagnostic\_settings](#input\_diagnostic\_settings)

Description: Diagnostic settings for sending logs to Log Analytics

Type:

```hcl
object({
    workspace_resource_id = string
    enabled               = optional(bool, true)
  })
```

### <a name="input_instance"></a> [instance](#input\_instance)

Description: Environment instance for region

Type: `number`

### <a name="input_location"></a> [location](#input\_location)

Description: Azure region

Type: `string`

### <a name="input_product"></a> [product](#input\_product)

Description: The product name this resource belongs to

Type: `string`

### <a name="input_resource_group_name"></a> [resource\_group\_name](#input\_resource\_group\_name)

Description: Resource group name

Type: `string`

### <a name="input_stage"></a> [stage](#input\_stage)

Description: Stage the resource is provisioned

Type: `string`

## Optional Inputs

The following input variables are optional (have default values):

### <a name="input_allowed_ips"></a> [allowed\_ips](#input\_allowed\_ips)

Description: Map of IPs in CIDR format

Type: `map(string)`

Default: `{}`

### <a name="input_databases"></a> [databases](#input\_databases)

Description: Map of databases to create with retention policies and settings

Type:

```hcl
map(object({
    collation                   = optional(string, "SQL_Latin1_General_CP1_CI_AS")
    max_size_gb                 = optional(number)
    backup_storage_account_type = optional(string, "Geo")

    short_term_retention_policy = optional(object({
      retention_days           = optional(number, 7)
      backup_interval_in_hours = optional(number, 12)
    }), {})

    long_term_retention_policy = optional(object({
      weekly_retention  = optional(string, "PT0S")
      monthly_retention = optional(string, "PT0S")
      yearly_retention  = optional(string, "PT0S")
      week_of_year      = optional(number, 1)
    }), {})
  }))
```

Default: `{}`

### <a name="input_elastic_pool"></a> [elastic\_pool](#input\_elastic\_pool)

Description: Elastic pool configuration for the SQL server

Type:

```hcl
object({
    max_size_gb    = optional(number, 50)
    zone_redundant = optional(bool, false)
    sku = optional(object({
      name     = optional(string, "StandardPool")
      capacity = optional(number, 50)
      tier     = optional(string, "Standard")
      family   = optional(string, null)
    }), {})
    per_database_settings = optional(object({
      min_capacity = optional(number, 0)
      max_capacity = optional(number, 50)
    }), {})
  })
```

Default: `{}`

### <a name="input_private_endpoints"></a> [private\_endpoints](#input\_private\_endpoints)

Description: n/a

Type:

```hcl
map(object({
    private_dns_zone_resource_id = string
    subnet_resource_id           = string
    resource_group_name          = optional(string)
  }))
```

Default: `{}`

### <a name="input_public_network_access_enabled"></a> [public\_network\_access\_enabled](#input\_public\_network\_access\_enabled)

Description: Whether public network access is enabled

Type: `bool`

Default: `false`

### <a name="input_server_version"></a> [server\_version](#input\_server\_version)

Description: SQL Server version

Type: `string`

Default: `"12.0"`

### <a name="input_short_description"></a> [short\_description](#input\_short\_description)

Description: Optional short description of the resource

Type: `string`

Default: `null`

### <a name="input_tags"></a> [tags](#input\_tags)

Description: Tags to be applied to the resource

Type: `map(string)`

Default: `{}`

### <a name="input_vulnerability_assessment"></a> [vulnerability\_assessment](#input\_vulnerability\_assessment)

Description: n/a

Type:

```hcl
object({
    enabled         = optional(bool, true)
    retention_days  = optional(number, 90)
    email_addresses = optional(list(string), [])
  })
```

Default: `{}`

## Outputs

The following outputs are exported:

### <a name="output_databases"></a> [databases](#output\_databases)

Description: n/a

### <a name="output_sql_server"></a> [sql\_server](#output\_sql\_server)

Description: n/a

## Modules

The following Modules are called:

### <a name="module_audit_storage"></a> [audit\_storage](#module\_audit\_storage)

Source: ../storage_account

Version:

### <a name="module_databases"></a> [databases](#module\_databases)

Source: Azure/avm-res-sql-server/azurerm//modules/database

Version: 0.1.5

### <a name="module_elastic_pool"></a> [elastic\_pool](#module\_elastic\_pool)

Source: Azure/avm-res-sql-server/azurerm//modules/elasticpool

Version: 0.1.5

### <a name="module_naming_db"></a> [naming\_db](#module\_naming\_db)

Source: ../naming

Version:

### <a name="module_naming_nic"></a> [naming\_nic](#module\_naming\_nic)

Source: ../naming

Version:

### <a name="module_naming_pe"></a> [naming\_pe](#module\_naming\_pe)

Source: ../naming

Version:

### <a name="module_naming_pool"></a> [naming\_pool](#module\_naming\_pool)

Source: ../naming

Version:

### <a name="module_naming_psc"></a> [naming\_psc](#module\_naming\_psc)

Source: ../naming

Version:

### <a name="module_naming_server"></a> [naming\_server](#module\_naming\_server)

Source: ../naming

Version:

### <a name="module_server"></a> [server](#module\_server)

Source: Azure/avm-res-sql-server/azurerm

Version: 0.1.5

<!-- END_TF_DOCS -->